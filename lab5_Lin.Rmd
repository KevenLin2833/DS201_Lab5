---
title: "lab5"
author: "Keven Lin"
Date: 11/13/2021
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggplot2)
library(readxl)
```

```{r}
#acc <- read.csv("https://raw.githubusercontent.com/xdaiISU/ds202materials/master/hwlabs/fars2017/accident.csv", stringsAsFactors = FALSE)
#per <- read.csv("https://raw.githubusercontent.com/xdaiISU/ds202materials/master/hwlabs/fars2017/person.csv", stringsAsFactors = FALSE)
acc <- read.csv("accident.csv", stringsAsFactors = FALSE)
per <- read.csv("person.csv", stringsAsFactors = FALSE)
```


# 1. Create a data frame containing the persons who are fatally hurt in the accidents (see FARS manual and look up variable INJ_SEV)
```{r}
fatallyHurt = per %>% filter(INJ_SEV %in% c(4)) %>% drop_na()
fatallyHurt
```
# 2. Create a data frame containing the most dangerous vehicle make in each state. The number of persons fatally hit in the vehicle make is used to assess the (non-)safety of a make. Make sure to handle the missing values appropriately. (look up variable MAKE)

```{r}
mostDangerous = fatallyHurt %>% group_by(STATE, MAKE) %>% summarise(DeathCount = sum(PER_NO)) %>% filter(DeathCount == max(DeathCount))
mostDangerous %>% select(STATE, MAKE, DeathCount)
```


# 3. Create a map, and label each state with the most dangerous vehicle. Discuss the definition of the most dangerous vehicle, and what you find from the map. (Hint: Read the description for the STATE and COUNTY columns in the FARS manual. The state & county codes are Geographic Locator Codes (GLCs) from the General Services Administrationâ€™s (GSA) publication. Use readxl::read_xlsx to read in the GLCs.)

```{r}
state = read_xlsx('States.xlsx')
territory = read_xlsx('Territories.xlsx')
state %>% group_by('State Code') %>% select('State Code', 'State Name')
territory
```

```{r}
map = map_data('state')
map %>% g
```


# 4. Join the accident and person table (work out which variable(s) to use)

# 5. Tally the number of accidents by day of the week (DAY_WEEK), hour of the day (HOUR) and gender (SEX). Visualize the results and explain what you find.

# 6. Now plot a choropleth map of the number of deaths on a county level. Also explain what you find.


# 7. (Optional) Is summer or winter more dangerous? Does this depend on states? Explore and explain.